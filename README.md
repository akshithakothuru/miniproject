Stock Price Prediction Script
Overview
This project consists of two scripts: predict_price.py for predicting future stock prices and backend.py for generating sentiment data to enhance predictions. The predict_price.py script uses a standard averaging method to forecast stock prices, combining historical stock data (loaded from a local file) with recent data (fetched from Yahoo Finance). Optionally, it incorporates sentiment analysis results generated by backend.py to adjust predictions based on market sentiment.
Features

Hybrid Data Source: Uses offline historical data (e.g., 2015-01-01 to 2024-12-31) and online recent data (e.g., 2025-01-01 to the present) for up-to-date predictions.
Live Predictions: Forecasts stock mid-prices for a user-specified number of future days.
Sentiment Analysis: Adjusts predictions based on market sentiment using data generated by backend.py.
Visualization: Plots historical and predicted mid-prices for easy analysis.
Error Handling: Includes retry logic for Yahoo Finance rate limits and fallback to historical data if recent data cannot be fetched.

Requirements

Python 3.9+
Required libraries:
yfinance
matplotlib
pandas
numpy
tensorflow (tested with TensorFlow 1.6, but only used for compatibility)
scikit-learn
transformers (for sentiment analysis)
torch (for sentiment analysis)
flask
flask-cors
selenium
beautifulsoup4
requests
nltk
diff-match-patch


Historical stock data file (e.g., Stocks/aapl.us.txt)
ChromeDriver executable for Selenium (for sentiment analysis)

Install the dependencies using pip:
pip install yfinance matplotlib pandas numpy tensorflow scikit-learn transformers torch flask flask-cors selenium beautifulsoup4 requests nltk diff-match-patch

Download NLTK data:
import nltk
nltk.download('stopwords')
nltk.download('punkt')

Setup

Prepare Historical Data for predict_price.py:

Download historical stock data for your chosen ticker (e.g., AAPL) from Yahoo Finance:
Go to finance.yahoo.com.
Search for the ticker (e.g., AAPL).
Navigate to "Historical Data", set the date range from January 1, 2015, to December 31, 2024, and download the CSV.


Rename the file to {ticker}.us.txt (e.g., aapl.us.txt).
Place the file in a Stocks directory within the project folder (e.g., C:\Users\akshi\mps\new\Stocks\aapl.us.txt).


Create the Stocks Directory:
mkdir Stocks


Set Up ChromeDriver for backend.py:

Download the ChromeDriver executable compatible with your version of Chrome from chromedriver.chromium.org.
Place it in C:\Users\akshi\mps\chromedriver.exe (or update the path in backend.py if different).


Place the Scripts:

Save both predict_price.py and backend.py in your project directory (e.g., C:\Users\akshi\mps\new\).



Usage

Run the Sentiment Analysis Script (backend.py):

Start the Flask server to generate sentiment data:python backend.py


The script will run a server on http://0.0.0.0:8000.
Make a request to the /analyze-sentiment endpoint with your ticker:curl "http://localhost:8000/analyze-sentiment?ticker=AAPL"


This will scrape recent articles from Yahoo Finance, compute sentiment scores using FinBERT, and save the results to C:\Users\akshi\mps\new\sentiment_analysis_results.csv.


Run the Prediction Script (predict_price.py):
python predict_price.py


Provide Inputs for predict_price.py:

Enter the number of days to forecast (e.g., 2 for today and tomorrow).
Select a ticker from the list (e.g., AAPL for Apple Inc.).


Output:

The backend.py will:
Fetch articles from Yahoo Finance for the specified ticker.
Compute sentiment scores and save them to sentiment_analysis_results.csv.
Return a JSON response with the average sentiment score and article details.


The predict_price.py will:
Load historical data from the local file (e.g., Stocks/aapl.us.txt).
Fetch recent data from Yahoo Finance (from 2025-01-01 to the present).
Display a plot of historical mid-prices.
Print the Mean Squared Error (MSE) for standard averaging on historical data.
Load sentiment data from sentiment_analysis_results.csv and apply adjustments to the predictions.
Predict mid-prices for the specified number of future days (e.g., June 8 and June 9, 2025).
Plot the historical and predicted mid-prices together.





Example
Running backend.py
python backend.py

Then:
curl "http://localhost:8000/analyze-sentiment?ticker=AAPL"

Output:
{
  "sentiment_score": 0.35,
  "articles": [
    {"title": "Apple Announces New Product", "url": "https://finance.yahoo.com/...", "sentiment_score": 0.4},
    {"title": "AAPL Shares Rise", "url": "https://finance.yahoo.com/...", "sentiment_score": 0.3}
  ]
}

This also generates sentiment_analysis_results.csv:
date,sentiment_score,headline,confidence,url
2025-06-07,0.4,Apple Announces New Product,1.0,https://finance.yahoo.com/...
2025-06-07,0.3,AAPL Shares Rise,1.0,https://finance.yahoo.com/...

Running predict_price.py
python predict_price.py

Input:
Enter the number of days to forecast (e.g., 2 for today and tomorrow): 2
Available tickers: ['MSFT', 'AAPL', 'GOOGL', 'TSLA', 'AMZN', 'NVDA', 'META', 'NFLX', 'JPM', 'WMT']
Enter the ticker symbol you want to predict (e.g., MSFT): AAPL

Output:
Selected ticker: AAPL for 2 days forecast.
Loading historical data from local file...
Loaded historical data from local file (shape: (2520, 5))
Historical data range: 2015-01-01 to 2024-12-31
Fetching recent data from Yahoo Finance from 2025-01-01 to 2025-06-07...
Loaded recent data from yfinance (shape: (90, 5))
Combined data shape: (2610, 5)
Data range: 2015-01-01 to 2025-06-07
[Plot of historical mid-prices]
MSE error for standard averaging on historical data: 0.12345
Performing sentiment analysis...
Sentiment data loaded successfully.
Sentiment CSV columns: ['date', 'sentiment_score', 'headline', 'confidence', 'url']
Latest sentiment score: 0.35
Sentiment adjustment for day 1: 3.50
Sentiment adjustment for day 2: 3.50
Predicted mid-price for 2025-06-08: 178.82
Base prediction: 175.32, Sentiment adjustment: 3.50
Predicted mid-price for 2025-06-09: 178.79
Base prediction: 175.29, Sentiment adjustment: 3.50
[Plot of historical and predicted mid-prices]

Notes

Rate Limits: The predict_price.py script includes retry logic for Yahoo Finance rate limits (5 retries, 5-minute delay). If the rate limit persists, wait 30-60 minutes and try again, or rely on historical data only (predictions will be less accurate). The backend.py also handles fetch failures with retries.
Accuracy: The standard averaging method in predict_price.py is a basic approach and may yield low accuracy. Sentiment analysis helps, but for better results, consider using more advanced methods like ARIMA or LSTM.
Historical Data Range: The predict_price.py script expects offline data from 2015-01-01 to 2024-12-31. If your data ends earlier, the Yahoo Finance fetch will cover the gap, but ensure you have at least 5 years of historical data for robust training.
Sentiment Analysis: Sentiment analysis requires running backend.py first to generate sentiment_analysis_results.csv. If this file is missing, predict_price.py will use a default adjustment of 0.0.

Troubleshooting

FileNotFoundError:
Ensure the historical data file (e.g., Stocks/aapl.us.txt) exists with the correct columns (Date, Open, High, Low, Close).
Ensure sentiment_analysis_results.csv exists in C:\Users\akshi\mps\new\ after running backend.py.


Rate Limit Errors: If Yahoo Finance rate limits persist in either script, wait 30-60 minutes or adjust the fetch parameters (e.g., reduce the date range).
Selenium Issues: Ensure ChromeDriver is installed and the path in backend.py (C:\Users\akshi\mps\chromedriver.exe) is correct.
Plotting Issues: Ensure matplotlib is installed and your environment supports graphical output (e.g., on Windows, ensure a backend like Tkinter is available).

Future Improvements

Add support for more advanced prediction methods (e.g., LSTM, ARIMA) in predict_price.py to improve accuracy.
Enhance backend.py to scrape additional sources (e.g., X posts, financial blogs) for broader sentiment analysis.
Implement caching for recent data in predict_price.py to further reduce API calls.
Add support for additional data sources as fallbacks in both scripts.

License
This project is for educational purposes and is not licensed for commercial use. Use at your own risk.
